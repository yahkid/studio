rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // PUBLIC READ, ADMIN WRITE Collections
    match /leadership/{docId} { allow read: if true; allow write: if request.auth != null; }
    match /sermons/{docId} { allow read: if true; allow write: if request.auth != null; }
    match /courses/{docId} { allow read: if true; allow write: if request.auth != null; }
    match /events/{docId} { allow read: if true; allow write: if request.auth != null; }
    match /blog_posts/{docId} { allow read: if true; allow write: if request.auth != null; }
    match /published_testimonials/{docId} { allow read: if true; allow write: if request.auth != null; }
    match /resources/{docId} { allow read: if true; allow write: if request.auth != null; }

    // USER-SPECIFIC DATA (Users can only access their own)
    match /user_course_progress/{docId} {
      allow read, update: if request.auth != null && request.auth.uid == resource.data.user_id;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
    }
    
    // SUBMISSIONS (Write-only for public, Read for admin/owner)
    match /decisions/{docId} { 
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
      // Pastoral team access logic would go here
      allow read, update: if request.auth != null; // Simplified for now
    }
    match /decisions/{decisionId}/contact_logs/{logId} {
      allow read, create: if request.auth != null; // Simplified for now
    }
    
    match /user_testimonies/{docId} {
        allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
        allow read, update, delete: if request.auth != null; // Simplified admin access
    }

    match /donations/{docId} {
      allow create: if true; // Anyone can create a pending donation record
      allow read, update: if request.auth != null; // Admins can read/update
    }

    // OTHER SUBMISSIONS (Public write, Admin read)
    match /lead_magnet_signups/{docId} { allow create: if true; allow read: if request.auth != null; }
    match /visit_requests/{docId} { allow create: if true; allow read: if request.auth != null; }
    match /exit_intent_offers/{docId} { allow create: if true; allow read: if request.auth != null; }
    match /weekly_updates_signups/{docId} { allow create: if true; allow read: if request.auth != null; }
    
    match /volunteer_partner_signups/{docId} {
      allow create: if true;
      allow read: if request.auth != null;
    }

    match /community_needs/{docId} {
      allow read, create, update: if request.auth != null; // Staff only
    }

  }
}
